# 4ì¼ì°¨_ì¸í”„ë¼ í”„ë¡œì íŠ¸

Created: Mar 12, 2020 1:58 PM



# ì¸í”„ë¼ í”„ë¡œì íŠ¸

ë„ì»¤(Docker) ë¥¼ ì‚¬ìš©í•´ ì‹¤ì œ í”„ë¡œì íŠ¸ë¥¼ ë„ì»¤í™”(Dockerize) í•œë‹¤.



## ë„ì»¤(Docker)

### ì´ë¯¸ì§€

ë„ì»¤ì—ì„œ ì´ë¯¸ì§€ë€ ì–´ë–¤ í™˜ê²½ì„ ì €ì¥í•´ë‘” íŒŒì¼ì„ ë§í•œë‹¤. ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ê³  ì—…ë¡œë“œí•  ë•Œ `pull` , `push` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ê¹ƒê³¼ ìœ ì‚¬í•˜ë‹¤. ê°œë…ì ìœ¼ë¡œë„ ìœ ì‚¬í•˜ê²Œ ìƒê°í•˜ë©´ í¸í•˜ë‹¤.



## ì„¤ì¹˜ ë° ëª…ë ¹ì–´ ì‹¤ìŠµ

### ë„ì»¤ ê°œë°œí™˜ê²½ ì„¤ì •

1. ë„ì»¤ ì„¤ì¹˜

    Windows10 home ë²„ì „ì€ ë„ì»¤ ì»¤ë®¤ë‹ˆí‹° ì—ë””ì…˜ ì„¤ì¹˜ê°€ ì•ˆëœë‹¤. (ì˜ˆì „ì— í•œë²ˆ ê¹”ë ¤ë‹¤ê°€ ì´ ì˜¤ë¥˜ë¡œ í¬ê¸°í•œ ì ì´ ìˆë‹¤.) ë„ì»¤ëŠ” ë¦¬ëˆ…ìŠ¤ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°€ìƒí™” ì»¨í…Œì´ë„ˆì´ë‹¤. ì¦‰, ë¦¬ëˆ…ìŠ¤ ìš´ì˜ì²´ì œì˜ ê°€ìƒí™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì¸ë° home ë²„ì „ì—ëŠ” ì´ ê°€ìƒí™” SWê°€ íƒ‘ì¬ë˜ì–´ìˆì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

    DockerToolbox ë¥¼ ì„¤ì¹˜í•˜ë©´ Virtual Box ë¥¼ í•¨ê»˜ ì„¤ì¹˜í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, íˆ´ë°•ìŠ¤ë¥¼ ì„¤ì¹˜í•œë‹¤.

2. ì‹¤í–‰

    ![4%20_/Untitled.png](4%20_/Untitled.png)

    ë„ì»¤ì™€ ì¸ì‚¬í–ˆë‹¤.

    ğŸ“Œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ `docker rum -name=[ì»¨í…Œì´ë„ˆ ì´ë¦„]`  ìœ¼ë¡œ ì´ë¦„ì„ ì§€ì •í•´ì„œ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

### ë„ì»¤ ê¸°ë³¸ ëª…ë ¹ì–´

1. ì»¨í…Œì´ë„ˆ ì¡°íšŒ

    `docker ps -a`

    í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡ì„ ì¶œë ¥í•œë‹¤.

    ![4%20_/Untitled%201.png](4%20_/Untitled%201.png)

2. ì»¨í…Œì´ë„ˆ ì‚­ì œ

    `docker rm [ì»¨í…Œì´ë„ˆ ID ë˜ëŠ” NAME]`

    ì•ì—ì„œ ìƒì„±í•œ ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•´ë³¸ë‹¤. ID ëŠ” ì¼ë¶€ë§Œ ì…ë ¥í•´ë„ ê°€ëŠ¥í•˜ë‹¤.

    ê·¸ë¦¬ê³  ë‹¤ì‹œ ëª©ë¡ì„ ë³´ë©´,

    ![4%20_/Untitled%202.png](4%20_/Untitled%202.png)

    í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆê°€ ì‚­ì œëœ ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

3. ì´ë¯¸ì§€ ì¡°íšŒ

    `docker images`

    ![4%20_/Untitled%203.png](4%20_/Untitled%203.png)

4. ì´ë¯¸ì§€ ì‚­ì œ

    `docker rmi [ì´ë¯¸ì§€ ID ë˜ëŠ” ì´ë¯¸ì§€ëª…:TAG]`

    â— ì‚­ì œí•˜ë ¤ëŠ” ì´ë¯¸ì§€ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” ì»¨í…Œì´ë„ˆê°€ ìˆë‹¤ë©´ ì‚­ì œë˜ì§€ ì•ŠëŠ”ë‹¤. ì»¨í…Œì´ë„ˆë¥¼ ë¨¼ì € ì‚­ì œí•´ì•¼ í•œë‹¤.

## Jenkins ì‚¬ìš©

### Jenkins ì‹¤í–‰

`docker run --name myjenkins -d -p 8080:8080 jenkins:2.60.3`

ê·¸ë¦¬ê³  ì•„ë˜ ëª…ë ¹ì–´ë¡œ Jenkins ì„œë²„ ì»¨í…Œì´ë„ˆì˜ bash ë¥¼ ì‹¤í–‰í•œë‹¤.

`docker exec -it myjenkins bash`

![4%20_/Untitled%204.png](4%20_/Untitled%204.png)

Jenkins bash ì—ì„œ

`/$ cat /etc/issue` ë¡œ ì»¨í…Œì´ë„ˆì˜ OS ë²„ì „ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`/$ cat /var/jenkins_home/secrets/initialAdminPassword` ë¡œ íŒ¨ìŠ¤ì›Œë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`doker exec -it myjenkins /var/jenkins_home/secrets/initialAdminPassword`

 ìœ„ì˜ ëª…ë ¹ì–´ë¡œ bash ì‹¤í–‰ + íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ ë‘ ê°€ì§€ë¥¼ í•œë²ˆì— ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

`docker cp myjenkins:[ê²½ë¡œ+íŒŒì¼ëª…] ./` : ì»¨í…Œì´ë„ˆ â†’ ë‚´ PC ë¡œ ë³µì‚¬

`docker cp [íŒŒì¼ëª…] myjenkins:[ê²½ë¡œ]` : ë‚´ PC â†’ ì»¨í…Œì´ë„ˆ ë³µì‚¬

### Jenkins ì ‘ì†

![4%20_/Untitled%205.png](4%20_/Untitled%205.png)

## ì§ì ‘ ë„ì»¤ ì´ë¯¸ì§€ ì œì‘í•˜ê¸°

### í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ

Vue.js ë¥¼ ì‚¬ìš©í•œ í”„ë¡ íŠ¸ì—”ë“œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê¸° ìœ„í•´,
[https://kr.vuejs.org/v2/cookbook/dockerize-vuejs-app.html](https://kr.vuejs.org/v2/cookbook/dockerize-vuejs-app.html) í˜ì´ì§€ë¥¼ ì°¸ê³ í–ˆë‹¤.

ë¨¼ì € Dockerfile ì„ ë§Œë“ ë‹¤.

í˜ì´ì§€ì˜ ì„¤ëª…ì— ë”°ë¼ NGINX ë¥¼ ì‚¬ìš©í•˜ëŠ” ì•„ë˜ ë‚´ìš©ì„ ê°€ì ¸ì™”ë‹¤.

    # build stage
    FROM node:lts-alpine as build-stage
    WORKDIR /app
    COPY package*.json ./
    RUN npm install --production
    COPY . .
    RUN npm run build
    
    # production stage
    FROM nginx:stable-alpine as production-stage
    COPY --from=build-stage /app/dist /usr/share/nginx/html
    EXPOSE 80
    CMD ["nginx", "-g", "daemon off;"]

ê·¸ë¦¬ê³  ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•œë‹¤.

`docker build -t ì´ë¯¸ì§€ì´ë¦„:íƒœê·¸`

`docker build . -t ì´ë¯¸ì§€ì´ë¦„:íƒœê·¸` ì´ë ‡ê²Œ í•˜ë©´ í˜„ì¬ ìœ„ì¹˜ì— ë§Œë“ ë‹¤.

ì˜ ë¹Œë“œë˜ì—ˆë‹¤.

![4%20_/Untitled%206.png](4%20_/Untitled%206.png)

íƒœê·¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

`docker tag front:0.1 front:latest`

![4%20_/Untitled%207.png](4%20_/Untitled%207.png)

`docker rmi front` ë¥¼ ì…ë ¥í•˜ë©´, latest ê°€ ì‚­ì œëœë‹¤.

`docker run -it -p 80:80 --rm front:01`

ì•„ë˜ì™€ ê°™ì´ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì˜ ì‹¤í–‰ëœë‹¤.

ğŸ“Œ Windows10 Home ì„ ì‚¬ìš©í•  ê²½ìš° ë¡œì»¬ì´ ì•„ë‹Œ ê°€ìƒ í™˜ê²½ì—ì„œ ë„ì»¤ê°€ ëŒì•„ê°€ë¯€ë¡œ, [localhost](http://localhost) ê°€ ì•„ë‹Œ 192.186.99.100 ì´ê³³ìœ¼ë¡œ ë“¤ì–´ê°€ì•¼ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.

![4%20_/Untitled%208.png](4%20_/Untitled%208.png)

### ë°±ì—”ë“œ ë¹Œë“œ

Java Spring + MySQLë¡œ ë§Œë“  ë°±ì—”ë“œ ì„œë²„ë¥¼ Docker ì´ë¯¸ì§€í™” í•œë‹¤.

ğŸ¤·â€â™€ï¸ ë°±ì—”ë“œ í™˜ê²½ì„¤ì •ì´ ë˜ì–´ìˆì§€ ì•Šì•„ì„œ jdk ì™€ maven ì„¤ì¹˜ë¶€í„° ì‹œì‘í–ˆë‹¤. ê°ê° ì„¤ì¹˜í•˜ê³ , í™˜ê²½ë³€ìˆ˜ê¹Œì§€ ì„¤ì •í•´ì¤€ ë’¤ ì‹œì‘í•œë‹¤.

ìŠ¤ì›¨ê±°ê°€ ì˜ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•˜ê³  Docker ì´ë¯¸ì§€ ë¹Œë“œì— ë“¤ì–´ê°„ë‹¤.

![4%20_/Untitled%209.png](4%20_/Untitled%209.png)

Dockerfile ì„ ë§Œë“ ë‹¤. ([https://spring.io/guides/gs/spring-boot-docker/](https://spring.io/guides/gs/spring-boot-docker/))

    FROM openjdk:8-jdk-alpine
    RUN addgroup -S spring && adduser -S spring -G spring
    USER spring:spring
    ARG JAR_FILE=target/*.jar
    COPY ${JAR_FILE} app.jar
    ENTRYPOINT ["java","-jar","/app.jar"]

`dokcer build . -t back:0.1`

ì˜ ë¹Œë“œë˜ì—ˆë‹¤.

![4%20_/Untitled%2010.png](4%20_/Untitled%2010.png)

`docker run -it -p 8080:8080 --rm back:0.1` ë¡œ ì‹¤í–‰ì‹œì¼°ì„ë•Œ, ì•„ë˜ì™€ ê°™ì´ ì˜ í™•ì¸ëœë‹¤.

![4%20_/Untitled%2011.png](4%20_/Untitled%2011.png)

MySQL ì»¨í…Œì´ë„ˆ ì‹¤í–‰&ì¡°íšŒ

`docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=ssafyssafyroomroom -e MYSQL_DATABASE=ssafy -d mysql --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci`

ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë˜ì—ˆê³ , ë°ì´í„°ë² ì´ìŠ¤ë„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

![4%20_/Untitled%2012.png](4%20_/Untitled%2012.png)


